<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>public/js/modules/ui-dialogs.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Dark theme matching app style - carefully scoped to not break layout */
        html, body {
            background-color: #1a1a1a !important;
            color: #e0e0e0 !important;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
            overflow-x: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Custom scrollbar styling for all browsers */
        * {
            scrollbar-width: thin !important;
            scrollbar-color: #404040 #1a1a1a !important;
        }

        /* Webkit browsers (Chrome, Safari, Edge) */
        *::-webkit-scrollbar {
            width: 6px !important;
            height: 6px !important;
        }

        *::-webkit-scrollbar-track {
            background: #1a1a1a !important;
        }

        *::-webkit-scrollbar-thumb {
            background-color: #404040 !important;
            border-radius: 3px !important;
        }

        *::-webkit-scrollbar-thumb:hover {
            background-color: #505050 !important;
        }

        /* Navigation sidebar - remove padding and white borders */
        nav {
            background-color: #242424 !important;
            border-right: 1px solid #404040 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow-x: hidden !important;
        }
        nav h2, nav h3 {
            color: #e0e0e0 !important;
            border-bottom: 1px solid #404040 !important;
            padding: 10px 15px !important;
            margin: 0 !important;
            background-color: #242424 !important;
            font-size: 14px !important;
            font-weight: 600 !important;
        }
        nav h3 {
            font-size: 13px !important;
        }
        nav ul {
            padding: 0 !important;
            margin: 0 !important;
            background-color: #242424 !important;
        }
        nav ul li {
            list-style: none !important;
            margin: 0 !important;
            padding: 0 !important;
            background-color: #242424 !important;
        }
        nav ul li a {
            color: #c9d1d9 !important;
            display: block !important;
            padding: 8px 15px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            background-color: #242424 !important;
            margin: 0 !important;
            border: none !important;
            font-size: 14px !important;
        }
        nav ul li a:hover {
            color: #60a5fa !important;
            background-color: rgba(96, 165, 250, 0.1) !important;
        }
        /* Module links (direct children of nav > ul > li) */
        nav > ul > li > a {
            color: #60a5fa !important;
            font-weight: 600 !important;
            padding: 10px 15px !important;
            font-size: 14px !important;
            border-left: 3px solid #60a5fa !important;
            padding-left: 12px !important;
        }
        nav > ul > li > a:hover {
            background-color: rgba(96, 165, 250, 0.15) !important;
        }
        /* Sub-items (methods/functions) indented */
        nav ul.methods {
            padding-left: 15px !important;
        }
        nav ul.methods li a {
            color: #9ca3af !important;
            font-size: 13px !important;
            padding: 6px 15px !important;
            font-weight: 400 !important;
        }
        nav ul.methods li a:hover {
            color: #c9d1d9 !important;
        }
        nav > h2:first-child {
            font-size: 16px !important;
            font-weight: 700 !important;
            padding: 12px 15px !important;
        }

        /* Main content area - dark background */
        #main {
            background-color: #1a1a1a !important;
            padding: 20px !important;
        }

        /* Article and sections - ensure dark background */
        article, section, .container-overview, .description {
            background-color: #1a1a1a !important;
        }

        /* Images - style demo images */
        img {
            max-width: 100% !important;
            height: auto !important;
            border: 1px solid #404040 !important;
            border-radius: 8px !important;
            margin: 20px 0 !important;
        }

        /* Links */
        a {
            color: #60a5fa !important;
            text-decoration: none !important;
        }
        a:hover {
            color: #93c5fd !important;
            text-decoration: underline !important;
        }

        /* Headings */
        h1, h2, h3, h4, h5, h6 {
            color: #e0e0e0 !important;
            border-bottom-color: #404040 !important;
            background-color: transparent !important;
        }
        h4.name {
            background-color: #2a2a2a !important;
            border: 1px solid #404040 !important;
        }

        /* Code blocks */
        pre {
            background-color: #0d1117 !important;
            border: 1px solid #404040 !important;
        }
        pre code {
            background-color: transparent !important;
        }
        code {
            background-color: #2a2a2a !important;
            color: #e0e0e0 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
        }

        /* Tables */
        table {
            border-color: #404040 !important;
            background-color: #1a1a1a !important;
        }
        table thead tr {
            background-color: #242424 !important;
        }
        table tbody tr {
            background-color: #1a1a1a !important;
        }
        table tbody tr:nth-child(even) {
            background-color: #1f1f1f !important;
        }
        table td, table th {
            border-color: #404040 !important;
            color: #e0e0e0 !important;
            background-color: transparent !important;
        }
        .params .name, .props .name {
            color: #10b981 !important;
            font-family: 'Courier New', monospace !important;
        }

        /* Descriptions and details */
        .description, .details, dt, dd, p, ul, ol, dl {
            color: #e0e0e0 !important;
            background-color: transparent !important;
        }

        /* Types */
        .type-signature {
            color: #a78bfa !important;
        }

        /* Source links */
        .details .details-item-container {
            border-left-color: #404040 !important;
        }

        /* Breadcrumbs */
        .page-title {
            color: #e0e0e0 !important;
        }

        /* Search */
        #nav-search {
            background-color: #2a2a2a !important;
            border: 1px solid #404040 !important;
            color: #e0e0e0 !important;
        }

        /* Mobile nav trigger */
        .navicon-button {
            background-color: #2a2a2a !important;
        }

        /* Footer */
        footer {
            background-color: #1a1a1a !important;
            color: #9ca3af !important;
            border-top: 1px solid #404040 !important;
            text-align: center !important;
            padding: 20px !important;
        }

        /* Remove horizontal scrollbar and white borders */
        * {
            box-sizing: border-box !important;
        }
    </style>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a><ul class='methods'><li data-type='method'><a href="module-api.html#.activateCampaign">activateCampaign</a></li><li data-type='method'><a href="module-api.html#.deleteChat">deleteChat</a></li><li data-type='method'><a href="module-api.html#.departAllVessels">departAllVessels</a></li><li data-type='method'><a href="module-api.html#.departVessel">departVessel</a></li><li data-type='method'><a href="module-api.html#.doWearMaintenanceBulk">doWearMaintenanceBulk</a></li><li data-type='method'><a href="module-api.html#.fetchAcquirableVessels">fetchAcquirableVessels</a></li><li data-type='method'><a href="module-api.html#.fetchAllianceMembers">fetchAllianceMembers</a></li><li data-type='method'><a href="module-api.html#.fetchAssignedPorts">fetchAssignedPorts</a></li><li data-type='method'><a href="module-api.html#.fetchBunkerPrices">fetchBunkerPrices</a></li><li data-type='method'><a href="module-api.html#.fetchCampaigns">fetchCampaigns</a></li><li data-type='method'><a href="module-api.html#.fetchChat">fetchChat</a></li><li data-type='method'><a href="module-api.html#.fetchContacts">fetchContacts</a></li><li data-type='method'><a href="module-api.html#.fetchMessengerChats">fetchMessengerChats</a></li><li data-type='method'><a href="module-api.html#.fetchMessengerMessages">fetchMessengerMessages</a></li><li data-type='method'><a href="module-api.html#.fetchUserSettings">fetchUserSettings</a></li><li data-type='method'><a href="module-api.html#.fetchVessels">fetchVessels</a></li><li data-type='method'><a href="module-api.html#.getCompanyNameCached">getCompanyNameCached</a></li><li data-type='method'><a href="module-api.html#.getMaintenanceCost">getMaintenanceCost</a></li><li data-type='method'><a href="module-api.html#.purchaseCO2">purchaseCO2</a></li><li data-type='method'><a href="module-api.html#.purchaseFuel">purchaseFuel</a></li><li data-type='method'><a href="module-api.html#.purchaseVessel">purchaseVessel</a></li><li data-type='method'><a href="module-api.html#.sendChatMessage">sendChatMessage</a></li><li data-type='method'><a href="module-api.html#.sendPrivateMessage">sendPrivateMessage</a></li></ul></li><li><a href="module-app.html">app</a></li><li><a href="module-automation.html">automation</a><ul class='methods'><li data-type='method'><a href="module-automation.html#.initAutomation">initAutomation</a></li><li data-type='method'><a href="module-automation.html#.runAutomationChecks">runAutomationChecks</a></li><li data-type='method'><a href="module-automation.html#.triggerAutoRebuyChecks">triggerAutoRebuyChecks</a></li><li data-type='method'><a href="module-automation.html#~calculateRemainingDemand">calculateRemainingDemand</a></li><li data-type='method'><a href="module-automation.html#~checkAutoCampaignRenewal">checkAutoCampaignRenewal</a></li><li data-type='method'><a href="module-automation.html#~checkAutoDepartAll">checkAutoDepartAll</a></li><li data-type='method'><a href="module-automation.html#~checkAutoRebuyCO2">checkAutoRebuyCO2</a></li><li data-type='method'><a href="module-automation.html#~checkAutoRebuyFuel">checkAutoRebuyFuel</a></li><li data-type='method'><a href="module-automation.html#~getTotalCapacity">getTotalCapacity</a></li><li data-type='method'><a href="module-automation.html#~performAutoRebuyCO2">performAutoRebuyCO2</a></li><li data-type='method'><a href="module-automation.html#~performAutoRebuyFuel">performAutoRebuyFuel</a></li><li data-type='method'><a href="module-automation.html#~sendAutoPilotFeedback">sendAutoPilotFeedback</a></li></ul></li><li><a href="module-bunker-management.html">bunker-management</a><ul class='methods'><li data-type='method'><a href="module-bunker-management.html#.buyMaxCO2">buyMaxCO2</a></li><li data-type='method'><a href="module-bunker-management.html#.buyMaxFuel">buyMaxFuel</a></li><li data-type='method'><a href="module-bunker-management.html#.getCurrentBunkerState">getCurrentBunkerState</a></li><li data-type='method'><a href="module-bunker-management.html#.updateBunkerStatus">updateBunkerStatus</a></li><li data-type='method'><a href="module-bunker-management.html#.updateCampaignsStatus">updateCampaignsStatus</a></li><li data-type='method'><a href="module-bunker-management.html#.updateCurrentCO2">updateCurrentCO2</a></li><li data-type='method'><a href="module-bunker-management.html#.updateCurrentCash">updateCurrentCash</a></li><li data-type='method'><a href="module-bunker-management.html#.updateCurrentFuel">updateCurrentFuel</a></li></ul></li><li><a href="module-chat.html">chat</a><ul class='methods'><li data-type='method'><a href="module-chat.html#.displayMessages">displayMessages</a></li><li data-type='method'><a href="module-chat.html#.handleMessageInput">handleMessageInput</a></li><li data-type='method'><a href="module-chat.html#.initWebSocket">initWebSocket</a></li><li data-type='method'><a href="module-chat.html#.loadAllianceMembers">loadAllianceMembers</a></li><li data-type='method'><a href="module-chat.html#.loadMessages">loadMessages</a></li><li data-type='method'><a href="module-chat.html#.parseMessageWithMentions">parseMessageWithMentions</a></li><li data-type='method'><a href="module-chat.html#.sendMessage">sendMessage</a></li><li data-type='method'><a href="module-chat.html#.setChatScrollListener">setChatScrollListener</a></li><li data-type='method'><a href="module-chat.html#~handleBackendAutoRepairComplete">handleBackendAutoRepairComplete</a></li></ul></li><li><a href="module-coop.html">coop</a><ul class='methods'><li data-type='method'><a href="module-coop.html#.closeCoopOverlay">closeCoopOverlay</a></li><li data-type='method'><a href="module-coop.html#.fetchCoopData">fetchCoopData</a></li><li data-type='method'><a href="module-coop.html#.sendCoopMax">sendCoopMax</a></li><li data-type='method'><a href="module-coop.html#.showCoopOverlay">showCoopOverlay</a></li><li data-type='method'><a href="module-coop.html#.updateCoopBadge">updateCoopBadge</a></li></ul></li><li><a href="module-messenger.html">messenger</a><ul class='methods'><li data-type='method'><a href="module-messenger.html#.closeAllChats">closeAllChats</a></li><li data-type='method'><a href="module-messenger.html#.closeChatSelection">closeChatSelection</a></li><li data-type='method'><a href="module-messenger.html#.openMessenger">openMessenger</a></li><li data-type='method'><a href="module-messenger.html#.openNewChat">openNewChat</a></li><li data-type='method'><a href="module-messenger.html#.showAllChats">showAllChats</a></li><li data-type='method'><a href="module-messenger.html#.updateUnreadBadge">updateUnreadBadge</a></li><li data-type='method'><a href="module-messenger.html#~loadPrivateMessages">loadPrivateMessages</a></li></ul></li><li><a href="module-server_automation.html">server/automation</a><ul class='methods'><li data-type='method'><a href="module-server_automation.html#~getRandomInterval">getRandomInterval</a></li><li data-type='method'><a href="module-server_automation.html#~initialize">initialize</a></li><li data-type='method'><a href="module-server_automation.html#~loadSettings">loadSettings</a></li><li data-type='method'><a href="module-server_automation.html#~parseInterval">parseInterval</a></li><li data-type='method'><a href="module-server_automation.html#~restartAutoRepair">restartAutoRepair</a></li><li data-type='method'><a href="module-server_automation.html#~runAutoRepair">runAutoRepair</a></li><li data-type='method'><a href="module-server_automation.html#~scheduleAutoRepair">scheduleAutoRepair</a></li></ul></li><li><a href="module-server_certificate.html">server/certificate</a><ul class='methods'><li data-type='method'><a href="module-server_certificate.html#~createHttpsServer">createHttpsServer</a></li><li data-type='method'><a href="module-server_certificate.html#~generateCA">generateCA</a></li><li data-type='method'><a href="module-server_certificate.html#~generateCertificate">generateCertificate</a></li><li data-type='method'><a href="module-server_certificate.html#~getNetworkIPs">getNetworkIPs</a></li><li data-type='method'><a href="module-server_certificate.html#~loadCertificate">loadCertificate</a></li></ul></li><li><a href="module-server_config.html">server/config</a></li><li><a href="module-server_middleware_index.html">server/middleware/index</a><ul class='methods'><li data-type='method'><a href="module-server_middleware_index.html#~setupMiddleware">setupMiddleware</a></li></ul></li><li><a href="module-server_routes_alliance.html">server/routes/alliance</a><ul class='methods'><li data-type='method'><a href="module-server_routes_alliance.html#.GET/api/alliance-members">GET /api/alliance-members</a></li><li data-type='method'><a href="module-server_routes_alliance.html#.GET/api/chat">GET /api/chat</a></li><li data-type='method'><a href="module-server_routes_alliance.html#.POST/api/company-name">POST /api/company-name</a></li><li data-type='method'><a href="module-server_routes_alliance.html#.POST/api/send-message">POST /api/send-message</a></li></ul></li><li><a href="module-server_routes_coop.html">server/routes/coop</a><ul class='methods'><li data-type='method'><a href="module-server_routes_coop.html#.GET/api/coop/data">GET /api/coop/data</a></li></ul></li><li><a href="module-server_routes_game.html">server/routes/game</a></li><li><a href="module-server_routes_messenger.html">server/routes/messenger</a><ul class='methods'><li data-type='method'><a href="module-server_routes_messenger.html#.GET/api/contact/get-contacts">GET /api/contact/get-contacts</a></li><li data-type='method'><a href="module-server_routes_messenger.html#.GET/api/messenger/get-chats">GET /api/messenger/get-chats</a></li><li data-type='method'><a href="module-server_routes_messenger.html#.POST/api/messenger/delete-chat">POST /api/messenger/delete-chat</a></li><li data-type='method'><a href="module-server_routes_messenger.html#.POST/api/messenger/get-messages">POST /api/messenger/get-messages</a></li><li data-type='method'><a href="module-server_routes_messenger.html#.POST/api/messenger/send-private">POST /api/messenger/send-private</a></li></ul></li><li><a href="module-server_routes_settings.html">server/routes/settings</a><ul class='methods'><li data-type='method'><a href="module-server_routes_settings.html#.GET/api/settings">GET /api/settings</a></li><li data-type='method'><a href="module-server_routes_settings.html#.POST/api/settings">POST /api/settings</a></li></ul></li><li><a href="module-server_utils_api.html">server/utils/api</a><ul class='methods'><li data-type='method'><a href="module-server_utils_api.html#~apiCall">apiCall</a></li><li data-type='method'><a href="module-server_utils_api.html#~getAllianceId">getAllianceId</a></li><li data-type='method'><a href="module-server_utils_api.html#~getChatFeed">getChatFeed</a></li><li data-type='method'><a href="module-server_utils_api.html#~getCompanyName">getCompanyName</a></li><li data-type='method'><a href="module-server_utils_api.html#~getUserCompanyName">getUserCompanyName</a></li><li data-type='method'><a href="module-server_utils_api.html#~getUserId">getUserId</a></li><li data-type='method'><a href="module-server_utils_api.html#~initializeAlliance">initializeAlliance</a></li></ul></li><li><a href="module-server_websocket.html">server/websocket</a><ul class='methods'><li data-type='method'><a href="module-server_websocket.html#~broadcast">broadcast</a></li><li data-type='method'><a href="module-server_websocket.html#~initWebSocket">initWebSocket</a></li><li data-type='method'><a href="module-server_websocket.html#~startChatAutoRefresh">startChatAutoRefresh</a></li><li data-type='method'><a href="module-server_websocket.html#~stopChatAutoRefresh">stopChatAutoRefresh</a></li></ul></li><li><a href="module-ui-dialogs.html">ui-dialogs</a><ul class='methods'><li data-type='method'><a href="module-ui-dialogs.html#.buyCampaign">buyCampaign</a></li><li data-type='method'><a href="module-ui-dialogs.html#.closeCampaignsOverlay">closeCampaignsOverlay</a></li><li data-type='method'><a href="module-ui-dialogs.html#.closeSettings">closeSettings</a></li><li data-type='method'><a href="module-ui-dialogs.html#.showCampaignsOverlay">showCampaignsOverlay</a></li><li data-type='method'><a href="module-ui-dialogs.html#.showConfirmDialog">showConfirmDialog</a></li><li data-type='method'><a href="module-ui-dialogs.html#.showContactList">showContactList</a></li><li data-type='method'><a href="module-ui-dialogs.html#.showSettings">showSettings</a></li></ul></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#.escapeHtml">escapeHtml</a></li><li data-type='method'><a href="module-utils.html#.formatNumber">formatNumber</a></li><li data-type='method'><a href="module-utils.html#.registerServiceWorker">registerServiceWorker</a></li><li data-type='method'><a href="module-utils.html#.renderStars">renderStars</a></li><li data-type='method'><a href="module-utils.html#.requestNotificationPermission">requestNotificationPermission</a></li><li data-type='method'><a href="module-utils.html#.showFeedback">showFeedback</a></li><li data-type='method'><a href="module-utils.html#.showNotification">showNotification</a></li><li data-type='method'><a href="module-utils.html#.showPriceAlert">showPriceAlert</a></li></ul></li><li><a href="module-vessel-management.html">vessel-management</a><ul class='methods'><li data-type='method'><a href="module-vessel-management.html#.departAllVessels">departAllVessels</a></li><li data-type='method'><a href="module-vessel-management.html#.purchaseSingleVessel">purchaseSingleVessel</a></li><li data-type='method'><a href="module-vessel-management.html#.repairAllVessels">repairAllVessels</a></li><li data-type='method'><a href="module-vessel-management.html#.updateVesselCount">updateVesselCount</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">public/js/modules/ui-dialogs.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview UI Dialogs Module - Manages all modal dialogs and overlay interfaces for user interactions.
 * Provides reusable dialog components for confirmations, settings, campaigns, contacts, and vessel/anchor information.
 *
 * Key Features:
 * - Generic confirmation dialog with customizable title, message, and details
 * - Settings overlay for managing price thresholds and AutoPilot options
 * - Marketing campaigns browser with activation functionality
 * - Contact list display with direct messaging integration
 * - Affordability calculations with visual indicators (green/red)
 *
 * Dialog Types:
 * - Confirmation Dialogs: Purchase confirmations, deletion warnings
 * - Settings Panel: Price thresholds, auto-rebuy toggles, AutoPilot features
 * - Campaign Browser: Shows active/inactive campaigns with purchase buttons
 * - Contact List: Filterable list of contacts and alliance members
 * - Info Dialogs: Anchor status, vessel information
 *
 * @module ui-dialogs
 * @requires utils - Formatting and feedback functions
 * @requires api - Backend API calls for data fetching
 */

import { escapeHtml, formatNumber, renderStars, showFeedback, showPriceAlert } from './utils.js';
import { fetchCampaigns, activateCampaign, fetchContacts } from './api.js';

/**
 * Shows a customizable confirmation dialog with optional details table.
 * Returns a promise that resolves to true/false based on user choice.
 *
 * Features:
 * - Custom title and message
 * - Optional details table with label/value pairs
 * - Affordability check (highlights Total Cost vs Available Cash)
 * - Customizable button text
 * - Click-outside-to-close functionality
 *
 * Affordability Logic:
 * - If second-to-last row is "Total Cost" and last row is "Available Cash"
 * - Compares values numerically
 * - Adds 'affordable' (green) or 'too-expensive' (red) CSS class
 *
 * @param {Object} options - Configuration options
 * @param {string} options.title - Dialog title
 * @param {string} [options.message] - Main message text
 * @param {Array&lt;{label: string, value: string}>} [options.details] - Details table rows
 * @param {string} [options.confirmText='Confirm'] - Confirm button text
 * @param {string} [options.cancelText='Cancel'] - Cancel button text (empty string to hide)
 * @returns {Promise&lt;boolean>} True if confirmed, false if canceled or closed
 *
 * @example
 * const confirmed = await showConfirmDialog({
 *   title: 'Purchase Fuel',
 *   message: 'Buy fuel to fill tank?',
 *   confirmText: 'Buy',
 *   details: [
 *     { label: 'Amount needed', value: '2,500t' },
 *     { label: 'Total Cost', value: '$1,000,000' },
 *     { label: 'Available Cash', value: '$5,000,000' }
 *   ]
 * });
 */
export function showConfirmDialog(options) {
  return new Promise((resolve) => {
    const overlay = document.createElement('div');
    overlay.className = 'confirm-dialog-overlay';

    const dialog = document.createElement('div');
    dialog.className = 'confirm-dialog';

    const detailsHtml = options.details ? `
      &lt;div class="confirm-dialog-details">
        ${options.details.map((detail, index) => {
          const isSecondToLastRow = index === options.details.length - 2;

          let rowClass = '';
          if (isSecondToLastRow &amp;&amp; detail.label === 'Total Cost') {
            const totalCostMatch = detail.value.match(/[\d,]+/);
            const availableCashMatch = options.details[options.details.length - 1].value.match(/[\d,]+/);

            if (totalCostMatch &amp;&amp; availableCashMatch) {
              const totalCost = parseInt(totalCostMatch[0].replace(/,/g, ''));
              const availableCash = parseInt(availableCashMatch[0].replace(/,/g, ''));
              rowClass = availableCash >= totalCost ? ' affordable' : ' too-expensive';
            }
          }

          return `
            &lt;div class="confirm-dialog-detail-row${rowClass}">
              &lt;span class="label">${escapeHtml(detail.label)}&lt;/span>
              &lt;span class="value">${escapeHtml(detail.value)}&lt;/span>
            &lt;/div>
          `;
        }).join('')}
      &lt;/div>
    ` : '';

    const cancelButtonHtml = options.cancelText !== ''
      ? `&lt;button class="confirm-dialog-btn cancel" data-action="cancel">${escapeHtml(options.cancelText || 'Cancel')}&lt;/button>`
      : '';

    dialog.innerHTML = `
      &lt;div class="confirm-dialog-header">
        &lt;h3>${escapeHtml(options.title || 'Confirm')}&lt;/h3>
        &lt;div class="confirm-dialog-buttons">
          ${cancelButtonHtml}
          &lt;button class="confirm-dialog-btn confirm" data-action="confirm">${escapeHtml(options.confirmText || 'Confirm')}&lt;/button>
        &lt;/div>
      &lt;/div>
      &lt;div class="confirm-dialog-body">
        ${options.message ? `&lt;p>${options.message}&lt;/p>` : ''}
        ${detailsHtml}
      &lt;/div>
    `;

    overlay.appendChild(dialog);
    document.body.appendChild(overlay);

    const handleClick = (e) => {
      const action = e.target.dataset.action;
      if (action === 'confirm' || action === 'cancel') {
        document.body.removeChild(overlay);
        resolve(action === 'confirm');
      }
    };

    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        document.body.removeChild(overlay);
        resolve(false);
      }
    });

    dialog.addEventListener('click', handleClick);
  });
}

/**
 * Displays the settings overlay with current settings populated in form fields.
 * Manages price thresholds and AutoPilot configuration interface.
 *
 * Settings Categories:
 * - Price Thresholds: Fuel, CO2, Maintenance alerts
 * - Auto-Rebuy: Automated fuel/CO2 purchasing with customizable triggers
 * - AutoPilot Features: Auto-depart, auto-repair, auto-campaigns
 * - Notifications: AutoPilot action notifications
 *
 * Dynamic UI Behavior:
 * - Auto-rebuy sections expand/collapse based on toggle state
 * - Threshold inputs lock when "Use Alert Price" is enabled
 * - Notifications checkbox only visible when AutoPilot features active
 *
 * Side Effects:
 * - Shows settings overlay
 * - Populates form fields from settings object
 * - Sets up conditional UI visibility
 *
 * @param {Object} settings - Current settings object
 * @param {number} settings.fuelThreshold - Fuel price alert threshold in $/ton
 * @param {number} settings.co2Threshold - CO2 price alert threshold in $/ton
 * @param {number} settings.maintenanceThreshold - Wear percentage for repair alerts
 * @param {boolean} settings.autoRebuyFuel - Enable auto-fuel purchasing
 * @param {boolean} settings.autoRebuyCO2 - Enable auto-CO2 purchasing
 * @param {boolean} settings.autoDepartAll - Enable auto-depart on ready vessels
 * @param {boolean} settings.autoBulkRepair - Enable auto-repair at threshold
 * @param {boolean} settings.autoCampaignRenewal - Enable auto-campaign renewal
 * @param {boolean} settings.autoPilotNotifications - Show notifications for AutoPilot actions
 */
export function showSettings(settings) {
  document.getElementById('fuelThreshold').value = settings.fuelThreshold;
  document.getElementById('co2Threshold').value = settings.co2Threshold;
  document.getElementById('maintenanceThreshold').value = settings.maintenanceThreshold;

  // Auto-Rebuy Fuel
  document.getElementById('autoRebuyFuel').checked = settings.autoRebuyFuel || false;
  document.getElementById('autoRebuyFuelOptions').style.display = settings.autoRebuyFuel ? 'block' : 'none';

  const fuelUseAlert = settings.autoRebuyFuelUseAlert !== undefined ? settings.autoRebuyFuelUseAlert : true;
  document.getElementById('autoRebuyFuelUseAlert').checked = fuelUseAlert;

  const fuelThresholdInput = document.getElementById('autoRebuyFuelThreshold');
  if (fuelUseAlert) {
    fuelThresholdInput.value = settings.fuelThreshold;
    fuelThresholdInput.disabled = true;
    fuelThresholdInput.style.opacity = '0.5';
    fuelThresholdInput.style.cursor = 'not-allowed';
  } else {
    fuelThresholdInput.value = settings.autoRebuyFuelThreshold || 400;
    fuelThresholdInput.disabled = false;
    fuelThresholdInput.style.opacity = '1';
    fuelThresholdInput.style.cursor = 'text';
  }

  // Auto-Rebuy CO2
  document.getElementById('autoRebuyCO2').checked = settings.autoRebuyCO2 || false;
  document.getElementById('autoRebuyCO2Options').style.display = settings.autoRebuyCO2 ? 'block' : 'none';

  const co2UseAlert = settings.autoRebuyCO2UseAlert !== undefined ? settings.autoRebuyCO2UseAlert : true;
  document.getElementById('autoRebuyCO2UseAlert').checked = co2UseAlert;

  const co2ThresholdInput = document.getElementById('autoRebuyCO2Threshold');
  if (co2UseAlert) {
    co2ThresholdInput.value = settings.co2Threshold;
    co2ThresholdInput.disabled = true;
    co2ThresholdInput.style.opacity = '0.5';
    co2ThresholdInput.style.cursor = 'not-allowed';
  } else {
    co2ThresholdInput.value = settings.autoRebuyCO2Threshold || 7;
    co2ThresholdInput.disabled = false;
    co2ThresholdInput.style.opacity = '1';
    co2ThresholdInput.style.cursor = 'text';
  }

  document.getElementById('autoDepartAll').checked = settings.autoDepartAll || false;
  document.getElementById('autoBulkRepair').checked = settings.autoBulkRepair || false;
  document.getElementById('autoRepairInterval').value = settings.autoRepairInterval || '2-3';
  document.getElementById('autoCampaignRenewal').checked = settings.autoCampaignRenewal || false;
  document.getElementById('autoPilotNotifications').checked = settings.autoPilotNotifications || false;

  // Intelligent Auto-Depart Settings
  const useRouteDefaults = settings.autoDepartUseRouteDefaults !== undefined ? settings.autoDepartUseRouteDefaults : true;
  document.getElementById('autoDepartUseRouteDefaults').checked = useRouteDefaults;

  const customSettingsDiv = document.getElementById('autoDepartCustomSettings');
  const minUtilInput = document.getElementById('minVesselUtilization');
  const speedInput = document.getElementById('autoVesselSpeed');

  if (useRouteDefaults) {
    customSettingsDiv.style.display = 'none';
  } else {
    customSettingsDiv.style.display = 'block';
    minUtilInput.value = settings.minVesselUtilization || 45;
    speedInput.value = settings.autoVesselSpeed || 50;
  }

  document.getElementById('settingsOverlay').style.display = 'flex';
}

/**
 * Closes the settings overlay.
 */
export function closeSettings() {
  document.getElementById('settingsOverlay').style.display = 'none';
}

/**
 * Displays marketing campaigns overlay with active campaigns and purchase options.
 * Shows company reputation stars and allows activating campaigns for reputation, awareness, and green.
 *
 * Campaign Display:
 * - Active campaigns shown with time remaining
 * - Inactive campaigns grouped by type with purchase buttons
 * - Reputation score displayed as star rating
 * - Duration and efficiency shown for each option
 *
 * Side Effects:
 * - Fetches campaign data from API
 * - Shows campaigns overlay
 * - Renders HTML with inline event handlers for purchase buttons
 *
 * @async
 * @returns {Promise&lt;void>}
 */
export async function showCampaignsOverlay() {
  try {
    const data = await fetchCampaigns();
    const allCampaigns = data.data.marketing_campaigns || [];
    const activeCampaigns = data.data.active_campaigns || [];
    const activeTypes = new Set(activeCampaigns.map(c => c.option_name));
    const totalReputation = data.user.reputation || 0;

    const contentDiv = document.getElementById('campaignsContent');
    const requiredTypes = ['reputation', 'awareness', 'green'];

    let html = '';

    html += `
      &lt;div style="text-align: center; margin-bottom: 30px;">
        &lt;div style="font-size: 14px; color: #9ca3af; margin-bottom: 10px;">
          Company Reputation
        &lt;/div>
        &lt;div style="font-size: 32px; margin-bottom: 8px; line-height: 1;">
          ${renderStars(totalReputation)}
        &lt;/div>
        &lt;div style="font-size: 18px; color: #10b981; font-weight: 600;">
          ${totalReputation}%
        &lt;/div>
      &lt;/div>
    `;

    if (activeCampaigns.length > 0) {
      html += `
        &lt;div style="margin-bottom: 30px;">
          &lt;h3 style="margin: 0 0 15px 0; font-size: 16px; color: #10b981;">
            ✅ Active Campaigns
          &lt;/h3>
          &lt;div style="display: flex; flex-direction: column; gap: 10px;">
      `;

      activeCampaigns.forEach(campaign => {
        const typeName = campaign.option_name.charAt(0).toUpperCase() + campaign.option_name.slice(1);
        const typeIcon = campaign.option_name === 'reputation' ? '⭐' : campaign.option_name === 'awareness' ? '📢' : '🌱';
        const efficiency = `${campaign.increase}%`;
        const duration = campaign.duration;

        const now = Math.floor(Date.now() / 1000);
        const timeLeft = campaign.end_time - now;
        const hoursLeft = Math.floor(timeLeft / 3600);
        const minutesLeft = Math.floor((timeLeft % 3600) / 60);
        const timeLeftStr = `${hoursLeft}h ${minutesLeft}m`;

        html += `
          &lt;div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px;">
            &lt;div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              &lt;div style="color: #10b981; font-size: 14px; font-weight: 600;">
                ${typeIcon} ${typeName}
              &lt;/div>
              &lt;div style="color: #10b981; font-size: 12px; font-weight: 600;">
                ${timeLeftStr} remaining
              &lt;/div>
            &lt;/div>
            &lt;div style="display: flex; justify-content: space-between; color: #9ca3af; font-size: 12px;">
              &lt;span>Duration: ${duration}h&lt;/span>
              &lt;span>Efficiency: ${efficiency}&lt;/span>
            &lt;/div>
          &lt;/div>
        `;
      });

      html += `
          &lt;/div>
        &lt;/div>
      `;
    }

    const inactiveTypes = requiredTypes.filter(type => !activeTypes.has(type));

    if (inactiveTypes.length > 0) {
      inactiveTypes.forEach(type => {
        const typeName = type.charAt(0).toUpperCase() + type.slice(1);
        const typeIcon = type === 'reputation' ? '⭐' : type === 'awareness' ? '📢' : '🌱';
        const typeCampaigns = allCampaigns.filter(c => c.option_name === type);

        html += `
          &lt;div style="margin-bottom: 25px;">
            &lt;h3 style="margin: 0 0 15px 0; font-size: 16px; color: #e0e0e0;">
              ${typeIcon} ${typeName} Campaigns
            &lt;/h3>
            &lt;div style="display: flex; flex-direction: column; gap: 10px;">
        `;

        typeCampaigns.forEach(campaign => {
          const duration = campaign.campaign_duration;
          const efficiency = `${campaign.min_efficiency}-${campaign.max_efficiency}%`;
          const price = formatNumber(campaign.price);

          html += `
            &lt;div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px; gap: 15px;">
              &lt;div style="flex: 1;">
                &lt;div style="color: #e0e0e0; font-size: 14px; font-weight: 600; margin-bottom: 4px;">
                  ${duration}h Duration
                &lt;/div>
                &lt;div style="color: #9ca3af; font-size: 12px;">
                  Efficiency: ${efficiency}
                &lt;/div>
              &lt;/div>
              &lt;div style="text-align: right; margin-right: 10px;">
                &lt;div style="color: #4ade80; font-size: 14px; font-weight: 600;">
                  $${price}
                &lt;/div>
              &lt;/div>
              &lt;button
                onclick="window.buyCampaign(${campaign.id}, '${typeName}', ${duration}, ${campaign.price})"
                style="
                  padding: 8px 16px;
                  background: rgba(16, 185, 129, 0.2);
                  border: 1px solid rgba(16, 185, 129, 0.4);
                  border-radius: 6px;
                  color: #10b981;
                  cursor: pointer;
                  font-weight: 600;
                  font-size: 13px;
                  transition: all 0.2s;
                  white-space: nowrap;
                "
                onmouseover="this.style.background='rgba(16, 185, 129, 0.3)'"
                onmouseout="this.style.background='rgba(16, 185, 129, 0.2)'"
              >
                Buy
              &lt;/button>
            &lt;/div>
          `;
        });

        html += `
            &lt;/div>
          &lt;/div>
        `;
      });
    }

    contentDiv.innerHTML = html;
    document.getElementById('campaignsOverlay').style.display = 'flex';
  } catch (error) {
    console.error('Error showing campaigns overlay:', error);
    showFeedback('Failed to load campaigns', 'error');
  }
}

/**
 * Closes the campaigns overlay.
 */
export function closeCampaignsOverlay() {
  document.getElementById('campaignsOverlay').style.display = 'none';
}

/**
 * Initiates marketing campaign purchase with confirmation dialog.
 * Shows cost breakdown and activates campaign upon confirmation.
 *
 * @async
 * @param {number} campaignId - Campaign ID to activate
 * @param {string} typeName - Campaign type name (Reputation/Awareness/Green)
 * @param {number} duration - Campaign duration in hours
 * @param {number} price - Campaign cost in dollars
 * @param {Object} [updateCallbacks] - Optional callbacks for UI updates
 * @param {Function} updateCallbacks.updateCampaignsStatus - Refresh campaigns status
 * @param {Function} updateCallbacks.updateBunkerStatus - Refresh cash display
 * @returns {Promise&lt;void>}
 */
export async function buyCampaign(campaignId, typeName, duration, price, updateCallbacks) {
  const confirmed = await showConfirmDialog({
    title: '📊 Activate Campaign',
    message: `Do you want to activate this ${typeName} campaign?`,
    confirmText: 'Activate',
    details: [
      { label: 'Type', value: typeName },
      { label: 'Duration', value: `${duration} hours` },
      { label: 'Cost', value: `$${formatNumber(price)}` }
    ]
  });

  if (!confirmed) return;

  try {
    const data = await activateCampaign(campaignId);

    showFeedback(`✅ ${typeName} campaign activated for ${duration} hours!`, 'success');

    closeCampaignsOverlay();
    if (updateCallbacks) {
      await updateCallbacks.updateCampaignsStatus();
      await updateCallbacks.updateBunkerStatus();
    }

  } catch (error) {
    console.error('Error buying campaign:', error);
    showFeedback('Failed to activate campaign', 'error');
  }
}

/**
 * Displays contact list overlay with contacts and alliance members.
 * Allows clicking send button to start new private conversation.
 *
 * Contact Categories:
 * - Personal Contacts: User's saved contacts
 * - Alliance Contacts: Current alliance members
 *
 * Side Effects:
 * - Fetches contacts from API
 * - Shows contact list overlay
 * - Registers click handlers to open messenger
 *
 * @async
 * @returns {Promise&lt;void>}
 */
export async function showContactList() {
  try {
    const data = await fetchContacts();
    const contacts = data.contacts || [];
    const allianceContacts = data.alliance_contacts || [];

    const listContainer = document.getElementById('contactListFeed');

    if (contacts.length === 0 &amp;&amp; allianceContacts.length === 0) {
      listContainer.innerHTML = '&lt;div class="empty-message">No contacts found.&lt;/div>';
    } else {
      const renderContactList = (contactsList) => {
        return contactsList.map((contact) => {
          const contactName = contact.company_name || `User ${contact.id}`;
          const userId = contact.id;

          return `
            &lt;div class="contact-row">
              &lt;div class="contact-name-cell">
                &lt;span class="contact-name">${escapeHtml(contactName)}&lt;/span>&lt;span class="contact-id"> (${userId})&lt;/span>
              &lt;/div>
              &lt;div class="contact-button-cell">
                &lt;button class="contact-send-btn" data-user-id="${userId}" data-company-name="${escapeHtml(contactName)}">
                  📩 Send
                &lt;/button>
              &lt;/div>
            &lt;/div>
          `;
        }).join('');
      };

      let html = '';

      if (contacts.length > 0) {
        html += `
          &lt;div class="contact-section">
            &lt;h3 class="contact-section-title">Contacts&lt;/h3>
            &lt;div class="contact-table">
              ${renderContactList(contacts)}
            &lt;/div>
          &lt;/div>
        `;
      }

      if (allianceContacts.length > 0) {
        html += `
          &lt;div class="contact-section">
            &lt;h3 class="contact-section-title">Alliance Contacts&lt;/h3>
            &lt;div class="contact-table">
              ${renderContactList(allianceContacts)}
            &lt;/div>
          &lt;/div>
        `;
      }

      listContainer.innerHTML = html;

      listContainer.querySelectorAll('.contact-send-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const userId = parseInt(btn.dataset.userId);
          const companyName = btn.dataset.companyName;

          document.getElementById('contactListOverlay').style.display = 'none';
          if (window.openNewChatFromContact) {
            window.openNewChatFromContact(companyName, userId);
          }
        });
      });
    }

    document.getElementById('contactListOverlay').style.display = 'flex';

  } catch (error) {
    console.error('Error loading contact list:', error);
    alert(`Error: ${error.message}`);
  }
}

export function closeContactList() {
  document.getElementById('contactListOverlay').style.display = 'none';
}

export async function showAnchorInfo() {
  const anchorBadge = document.getElementById('anchorCount');
  const vesselsAtAnchor = parseInt(anchorBadge.textContent) || 0;

  await showConfirmDialog({
    title: '⚓ Vessels at Anchor',
    message: `You have ${vesselsAtAnchor} vessel${vesselsAtAnchor === 1 ? '' : 's'} at anchor.\n\nPlease plan routes for your vessels in the game. Once you assign routes, the vessel count will update automatically.`,
    confirmText: 'Got it',
    cancelText: ''
  });
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation Version: 0.0.7 - ShippingManager CoPilot
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
