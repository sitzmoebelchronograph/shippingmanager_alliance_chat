<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öì Shipping Manager - CoPilot</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Price Alerts (center, with spin animation) -->
    <div id="globalFeedback"></div>

    <!-- Side Notifications (right-top, stacking) -->
    <div id="sideNotifications"></div>

    <div class="container">
        <div class="header">
            <div class="header-top" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <h1>
                    <span class="header-icon" style="position: relative; display: inline-block;">
                        ‚öì
                        <span id="ceoLevelBadge" style="position: absolute; top: -14px; right: -3px; width: 30px; height: 30px; display: none;">
                            <svg viewBox="0 0 24 24" style="width: 100%; height: 100%; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4));">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#fbbf24" stroke="#f59e0b" stroke-width="0.5"/>
                            </svg>
                            <span id="ceoLevelNumber" style="position: absolute; top: 72.5%; left: 50%; transform: translate(-50%, -50%); font-size: 12px; font-weight: 900; color: #ffffff; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">0</span>
                        </span>
                    </span>
                    <span class="header-text" id="pageHeaderTitle">Shipping Manager - CoPilot</span>
                </h1>
                <div class="header-right">
                    <button id="notificationBtn" class="megaphone-btn">
                        <span class="megaphone-icon"></span>
                        <span class="sound-waves"></span>
                    </button>
                    <script>
                        // Set correct state immediately to avoid flicker
                        (function() {
                            const btn = document.getElementById('notificationBtn');
                            if (Notification.permission !== "granted") {
                                // Show red disabled megaphone
                                btn.classList.add('disabled');
                                btn.style.display = '';
                            } else {
                                // Hide button completely
                                btn.style.display = 'none';
                            }
                        })();
                    </script>
                </div>
            </div>
            <div class="header-info-displays" style="display: flex; align-items: center; gap: 6px; padding-left: 10px; margin-top: 8px;">
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="color: #fbbf24; font-weight: 600; font-size: 15px;">üíé</span>
                    <span id="pointsDisplay" style="color: #fbbf24; font-weight: 600; font-size: 13px;">-</span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="color: #4ade80; font-weight: 600; font-size: 15px;">üí∞</span>
                    <span id="cashDisplay" style="color: #4ade80; font-weight: 600; font-size: 13px;">$-</span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="font-size: 15px;">üìà</span>
                    <span id="stockDisplay" style="font-weight: 500; font-size: 13px; color: #9ca3af;">-</span>
                    <span style="font-size: 13px; color: #9ca3af;">$</span>
                    <span id="stockTrend" style="font-size: 13px;"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="font-size: 15px;">‚õΩ</span>
                    <span id="fuelPriceDisplay" style="font-weight: 500; font-size: 13px; color: #9ca3af;">$-/t</span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="font-size: 15px;">üí®</span>
                    <span id="co2PriceDisplay" style="font-weight: 500; font-size: 13px; color: #9ca3af;">$-/t</span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="font-size: 15px;">‚öì</span>
                    <span id="anchorSlotsDisplay" style="font-weight: 500; font-size: 13px; color: #9ca3af;">-/-</span>
                </div>
                <div style="display: flex; align-items: center; gap: 2px;">
                    <span style="font-size: 15px;">ü§ù</span>
                    <span id="coopDisplay" style="font-weight: 500; font-size: 13px; color: #9ca3af;">-/-</span>
                </div>
            </div>
        </div>

        <div class="action-bar" style="justify-content: space-between;">
            <div style="display: flex; gap: 10px;">
                <button id="fuelBtn" class="action-btn bunker-btn" title="Buy max fuel">
                    ‚õΩ <span id="fuelDisplay">-/-</span>
                </button>
                <button id="co2Btn" class="action-btn bunker-btn" title="Buy max CO2">
                    üí® <span id="co2Display">-/-</span>
                </button>
            </div>
            <div class="action-buttons-group">
                <button id="departAllBtn" class="action-btn" disabled title="Depart all vessels from harbor">
                    üö¢
                    <span id="vesselCount" class="action-badge" style="display: none;">0</span>
                </button>
                <button id="anchorBtn" class="action-btn" disabled title="Vessels at anchor">
                    ‚öì
                    <span id="anchorCount" class="action-badge" style="display: none;">0</span>
                </button>
                <button id="repairAllBtn" class="action-btn" disabled title="Repair all vessels with high wear">
                    üîß
                    <span id="repairCount" class="action-badge" style="display: none;">0</span>
                </button>
                <button id="campaignsBtn" class="action-btn" title="Marketing campaigns status">
                    üìä
                    <span id="campaignsCount" class="action-badge" style="display: none;">0</span>
                </button>
                <button id="allChatsBtn" class="action-btn" title="View all private messages">
                    üì¨
                    <span id="unreadBadge" class="action-badge" style="display: none; background: #ef4444;">0</span>
                </button>
                <button id="buyVesselsBtn" class="action-btn" title="Buy vessels">
                    ‚õ¥Ô∏è
                    <span style="position: absolute; bottom: -6px; left: 0px; color: #10b981; font-size: 20px; font-weight: bold; line-height: 1;">+</span>
                    <span id="pendingVesselsBadge" class="action-badge" style="display: none; background: #f97316;">0</span>
                </button>
                <button id="coopBtn" class="action-btn" title="Alliance Cooperation">
                    ü§ù
                    <span id="coopBadge" class="action-badge" style="display: none;">-/-</span>
                </button>
                <button id="contactListBtn" class="action-btn" title="View contact list">
                    üë•
                </button>
                <button id="settingsBtn" class="action-btn" title="Settings">
                    ‚öôÔ∏è
                </button>
                <button id="docsBtn" class="action-btn" title="Documentation">
                    üìñ
                </button>
            </div>
        </div>

        <div class="chat-feed" id="chatFeed">
            <div class="empty-message">Loading chat...</div>
        </div>

        <div class="input-section">
            <div class="input-wrapper">
                <textarea
                    id="messageInput"
                    placeholder="Type... or use @ for mentions or Shift+Enter for new line"
                    maxlength="1000"
                    autocomplete="off"
                ></textarea>
                <div style="display: flex; flex-direction: column; gap: 4px;">
                    <button id="sendMessageBtn">Send</button>
                    <div class="char-count" id="charCount">0 / 1000 characters</div>
                </div>
            </div>
            <div id="feedback"></div>
        </div>
    </div>
    
    <div id="allChatsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>All Private Conversations</h2>
                <button id="closeAllChatsBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" id="allChatsList">
            </div>
        </div>
    </div>

    <div id="contactListOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>üë• Contact List</h2>
                <button id="closeContactListBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" id="contactListFeed">
            </div>
        </div>
    </div>

    <div id="chatSelectionOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <button id="backToAllChatsBtn" class="close-btn" style="margin-right: 10px;" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">‚Üê</span></button>
                <h2 id="chatSelectionTitle">Select Conversation</h2>
                <button id="closeChatSelectionBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" id="chatSelectionList">
            </div>
        </div>
    </div>

    <div id="messengerOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <button id="backToSelectionBtn" class="close-btn" style="margin-right: 10px;" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">‚Üê</span></button>
                <h2 id="messengerTitle">Private Chat with ...</h2>
                <button id="deleteChatBtn" class="close-btn" style="color: #ef4444; margin-right: 10px;" onmouseover="this.querySelector('span').style.animation='shake-trash-simple 0.5s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">üóëÔ∏è</span></button>
                <button id="closeMessengerBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" id="messengerFeed">
            </div>
            <div class="messenger-input" style="flex-direction: column; gap: 10px;">
                <div id="subjectInputWrapper" style="display: none;">
                    <input
                        type="text"
                        id="subjectInput"
                        placeholder="Subject..."
                        maxlength="100"
                        style="width: 100%; background: #2a2a2a; border: 1px solid #404040; color: #e0e0e0; padding: 10px 15px; border-radius: 6px; font-family: inherit;"
                    />
                </div>
                <div style="display: flex; gap: 10px;">
                    <textarea
                        id="messengerInput"
                        placeholder="Type message..."
                        maxlength="1000"
                        autocomplete="off"
                    ></textarea>
                    <button id="sendPrivateMessageBtn" class="send-btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="campaignsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>üìä Marketing Campaigns</h2>
                <button id="closeCampaignsBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" style="padding: 20px; overflow-y: auto;">
                <div id="campaignsContent" style="max-width: 600px; margin: 0 auto;">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="coopOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>ü§ù Alliance Cooperation</h2>
                <button id="closeCoopBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" style="padding: 20px; overflow-y: auto;">
                <div id="coopContent" style="max-width: 800px; margin: 0 auto;">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="settingsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button id="closeSettingsBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" style="padding: 20px; overflow-y: auto;">
                <div style="max-width: 500px; margin: 0 auto;">
                    <!-- Price Alerts Section -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0e0e0;">Price Alerts</h3>
                        <p style="margin: 0 0 15px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Get browser notifications when prices drop below these thresholds
                        </p>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label for="fuelThreshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                    ‚õΩ Fuel Alert Threshold ($/ton)
                                </label>
                                <input
                                    type="number"
                                    id="fuelThreshold"
                                    value="400"
                                    min="1"
                                    max="9999"
                                    style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                                />
                            </div>

                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label for="co2Threshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                    üí® CO2 Alert Threshold ($/ton)
                                </label>
                                <input
                                    type="number"
                                    id="co2Threshold"
                                    value="7"
                                    min="1"
                                    max="9999"
                                    style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                                />
                            </div>
                        </div>

                        <button id="testAlertBtn" style="
                            margin-top: 12px;
                            width: 100%;
                            padding: 10px;
                            background: rgba(59, 130, 246, 0.2);
                            border: 1px solid rgba(59, 130, 246, 0.4);
                            border-radius: 6px;
                            color: #60a5fa;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.2)'">
                            üîî Test Browser Notification
                        </button>
                    </div>

                    <!-- Auto-Pilot Settings Section -->
                    <div style="margin-bottom: 25px; padding: 20px; background: rgba(16, 185, 129, 0.05); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 12px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 18px; color: #10b981; font-weight: 700;">ü§ñ Auto-Pilot - Settings</h3>
                        <p style="margin: 0 0 20px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Enable automated game management. When ANY function is active, page title changes to <strong>"AutoPilot"</strong> mode.
                        </p>

                        <!-- Desktop Notifications Master Toggle -->
                        <div style="padding: 14px; background: rgba(59, 130, 246, 0.15); border: 2px solid rgba(59, 130, 246, 0.4); border-radius: 8px; margin-bottom: 16px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="enableDesktopNotifications" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;" checked>
                                <span style="color: #60a5fa; font-size: 15px; font-weight: 600;">üîî Enable Desktop Notifications</span>
                            </label>
                            <p style="margin: 8px 0 0 32px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                Show browser notifications for alerts and AutoPilot actions (requires browser permission)
                            </p>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Auto-rebuy Fuel -->
                            <div style="padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="autoRebuyFuel" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                    <span style="color: #e0e0e0; font-size: 14px; font-weight: 500;">‚õΩ Auto-Rebuy Fuel</span>
                                </label>
                                <p style="margin: 8px 0 0 28px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                    Automatically purchase fuel when price drops at/below threshold
                                </p>

                                <!-- Nested: Use Alert Value -->
                                <div id="autoRebuyFuelOptions" style="margin: 12px 0 0 28px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border-left: 3px solid rgba(251, 191, 36, 0.3);">
                                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 10px;">
                                        <input type="checkbox" id="autoRebuyFuelUseAlert" style="width: 16px; height: 16px; margin-right: 8px; cursor: pointer;">
                                        <span style="color: #d1d5db; font-size: 13px;">Use alert threshold</span>
                                    </label>
                                    <div>
                                        <label style="color: #9ca3af; font-size: 12px; display: block; margin-bottom: 4px;">Max price ($/ton):</label>
                                        <input type="number" id="autoRebuyFuelThreshold" min="1" max="1000" value="400" style="width: 100%; padding: 6px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: #e0e0e0; font-size: 13px;">
                                    </div>
                                </div>
                            </div>

                            <!-- Auto-rebuy CO2 -->
                            <div style="padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="autoRebuyCO2" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                    <span style="color: #e0e0e0; font-size: 14px; font-weight: 500;">üí® Auto-Rebuy CO2</span>
                                </label>
                                <p style="margin: 8px 0 0 28px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                    Automatically purchase CO2 when price drops at/below threshold
                                </p>

                                <!-- Nested: Use Alert Value -->
                                <div id="autoRebuyCO2Options" style="margin: 12px 0 0 28px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border-left: 3px solid rgba(96, 165, 250, 0.3);">
                                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 10px;">
                                        <input type="checkbox" id="autoRebuyCO2UseAlert" style="width: 16px; height: 16px; margin-right: 8px; cursor: pointer;">
                                        <span style="color: #d1d5db; font-size: 13px;">Use alert threshold</span>
                                    </label>
                                    <div>
                                        <label style="color: #9ca3af; font-size: 12px; display: block; margin-bottom: 4px;">Max price ($/ton):</label>
                                        <input type="number" id="autoRebuyCO2Threshold" min="1" max="100" value="7" style="width: 100%; padding: 6px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: #e0e0e0; font-size: 13px;">
                                    </div>
                                </div>
                            </div>

                            <!-- Auto-Depart All -->
                            <div style="padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="autoDepartAll" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                    <span style="color: #e0e0e0; font-size: 14px; font-weight: 500;">üö¢ Auto-Depart All</span>
                                </label>
                                <p style="margin: 8px 0 0 28px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                    Intelligently departs vessels based on port demand and fuel prices.<br>
                                    <span style="color: #fbbf24;">‚ö†Ô∏è Requires minimum 10t fuel in bunker</span> - no vessels will be sent if fuel is below this threshold.
                                </p>

                                <!-- Nested: Intelligent Auto-Depart Settings -->
                                <div style="margin: 12px 0 0 28px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border-left: 3px solid rgba(96, 165, 250, 0.3);">
                                    <!-- Use Route Default Checkbox -->
                                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 10px;">
                                        <input type="checkbox" id="autoDepartUseRouteDefaults" style="width: 16px; height: 16px; margin-right: 8px; cursor: pointer;" checked>
                                        <span style="color: #d1d5db; font-size: 13px;">Use route defaults</span>
                                    </label>

                                    <!-- Min Utilization (hidden when using route defaults) -->
                                    <div id="autoDepartCustomSettings" style="display: none;">
                                        <div style="margin-bottom: 8px;">
                                            <label style="color: #9ca3af; font-size: 12px; display: block; margin-bottom: 4px;">üì¶ Min Utilization (%):</label>
                                            <select
                                                id="minVesselUtilization"
                                                style="width: 100%; padding: 6px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: #e0e0e0; font-size: 13px;"
                                            >
                                                <option value="30">30%</option>
                                                <option value="45" selected>45%</option>
                                                <option value="60">60%</option>
                                                <option value="75">75%</option>
                                                <option value="90">90%</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label style="color: #9ca3af; font-size: 12px; display: block; margin-bottom: 4px;">‚ö° Vessel Speed (10-100%):</label>
                                            <input
                                                type="number"
                                                id="autoVesselSpeed"
                                                min="10"
                                                max="100"
                                                value="50"
                                                style="width: 100%; padding: 6px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: #e0e0e0; font-size: 13px;"
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Auto Bulk Repair -->
                            <div style="padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="autoBulkRepair" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                    <span style="color: #e0e0e0; font-size: 14px; font-weight: 500;">üîß Auto Bulk Repair</span>
                                </label>
                                <p style="margin: 8px 0 0 28px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                    Automatically repair all vessels as long as funds are available
                                </p>

                                <!-- Nested: Repair Interval -->
                                <div style="margin: 12px 0 0 28px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border-left: 3px solid rgba(96, 165, 250, 0.3);">
                                    <label style="color: #9ca3af; font-size: 12px; display: block; margin-bottom: 4px;">‚è±Ô∏è Check Interval:</label>
                                    <select id="autoRepairInterval" style="width: 100%; padding: 6px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: #e0e0e0; font-size: 13px;">
                                        <option value="0-1">0-1 hour</option>
                                        <option value="1-2">1-2 hours</option>
                                        <option value="2-3" selected>2-3 hours</option>
                                        <option value="3-4">3-4 hours</option>
                                        <option value="4-5">4-5 hours</option>
                                        <option value="5-6">5-6 hours</option>
                                        <option value="6-12">6-12 hours</option>
                                        <option value="12-24">12-24 hours</option>
                                    </select>
                                    <p style="margin: 6px 0 0 0; color: #6b7280; font-size: 11px; line-height: 1.3;">
                                        Random check within this time range (runs on server)
                                    </p>
                                </div>
                            </div>

                            <!-- Auto Campaign Renewal -->
                            <div style="padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="autoCampaignRenewal" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                    <span style="color: #e0e0e0; font-size: 14px; font-weight: 500;">üìä Auto Campaign Renewal</span>
                                </label>
                                <p style="margin: 8px 0 0 28px; color: #9ca3af; font-size: 12px; line-height: 1.4;">
                                    When a campaign expires, automatically purchase the most expensive one that current funds allow
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance Section -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0e0e0;">Maintenance</h3>
                        <p style="margin: 0 0 15px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Automatically repair vessels when wear reaches this threshold
                        </p>

                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                            <label for="maintenanceThreshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                üîß Wear Threshold
                            </label>
                            <select
                                id="maintenanceThreshold"
                                style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                            >
                                <option value="10">10%</option>
                                <option value="20">20%</option>
                            </select>
                        </div>
                    </div>

                    <!-- Certificate Section -->
                    <div>
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0e0e0;">üîí Certificate Installation</h3>
                        <p style="margin: 0 0 15px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Install the CA certificate to remove security warnings and enable notifications on mobile devices
                        </p>

                        <div style="background: rgba(31, 41, 55, 0.5); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <div style="margin-bottom: 12px;">
                                <strong style="color: #e0e0e0; font-size: 14px;">üíª Desktop (Windows/Mac/Linux):</strong>
                                <p style="margin: 5px 0 0 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                                    Install the certificate to remove "Not Secure" warnings in your browser
                                </p>
                            </div>
                            <div>
                                <strong style="color: #e0e0e0; font-size: 14px;">üì± Mobile (Android/iOS):</strong>
                                <p style="margin: 5px 0 0 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                                    Required for browser notifications to work. Install via Settings ‚Üí Security ‚Üí Install Certificate
                                </p>
                            </div>
                        </div>

                        <a href="/ca-cert.pem" download="ShippingManager-CA.pem" style="
                            display: block;
                            width: 100%;
                            padding: 12px;
                            background: rgba(59, 130, 246, 0.2);
                            border: 1px solid rgba(59, 130, 246, 0.4);
                            border-radius: 6px;
                            color: #60a5fa;
                            text-align: center;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                            text-decoration: none;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.2)'">
                            üì• Download CA Certificate
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="buyVesselsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2 id="buyVesselsHeader">‚õ¥Ô∏è Buy Vessels</h2>
                <button id="closeBuyVesselsBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>

            <div class="vessel-header-controls">
                <button id="filterContainerBtn" class="vessel-filter-btn active" data-type="container">
                    üì¶ Container
                </button>
                <button id="filterTankerBtn" class="vessel-filter-btn" data-type="tanker">
                    üõ¢Ô∏è Tanker
                </button>
                <button id="filterEngineBtn" class="vessel-filter-btn" data-type="engine">
                    ‚öôÔ∏è Engine
                </button>
                <button id="filterPendingBtn" class="vessel-filter-btn" style="display: none;">
                    ‚è±Ô∏è Pending (<span id="pendingCount">0</span>)
                </button>
                <button id="bulkBuyBtn" class="bulk-buy-btn" style="display: none;">
                    üí∞ Bulk Buy (<span id="selectedCount">0</span>)
                </button>
            </div>

            <div class="messenger-feed" id="vesselCatalogFeed" style="padding: 20px; overflow-y: auto;">
                <div style="text-align: center; color: #9ca3af; padding: 40px;">
                    Loading vessels...
                </div>
            </div>
        </div>
    </div>

    <div id="engineFilterOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>‚öôÔ∏è Filter by Engine Type</h2>
                <button id="closeEngineFilterBtn" class="close-btn" onmouseover="this.querySelector('span').style.animation='pulse-arrow 0.6s ease-in-out infinite'" onmouseout="this.querySelector('span').style.animation='none'"><span style="display: inline-block;">√ó</span></button>
            </div>
            <div class="messenger-feed" id="engineFilterList" style="padding: 20px; overflow-y: auto;">
                <!-- Engine list will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script type="module" src="/js/script.js"></script>
</body>
</html>