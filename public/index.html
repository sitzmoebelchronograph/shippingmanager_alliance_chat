<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Manager - Messenger</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="globalFeedback"></div>

    <div class="container">
        <div class="header">
            <h1>‚öì Shipping Manager - Messenger</h1>
            <div class="header-right">
                <button id="notificationBtn">üîî Enable Notifications</button>
                <div class="status">
                    <div class="status-dot"></div>
                    <span>Connected</span>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <div style="display: flex; align-items: center; gap: 20px; margin-right: auto; padding-left: 10px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="color: #4ade80; font-weight: 600; font-size: 16px;">üí∞</span>
                    <span id="cashDisplay" style="color: #4ade80; font-weight: 600; font-size: 14px;">$-</span>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="font-size: 16px;">‚õΩ</span>
                    <span id="fuelPriceDisplay" style="font-weight: 500; font-size: 14px; color: #9ca3af;">$-/t</span>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="font-size: 16px;">üí®</span>
                    <span id="co2PriceDisplay" style="font-weight: 500; font-size: 14px; color: #9ca3af;">$-/t</span>
                </div>
            </div>
            <button id="fuelBtn" class="action-btn bunker-btn" title="Buy max fuel">
                ‚õΩ <span id="fuelDisplay">-/-</span>
            </button>
            <button id="co2Btn" class="action-btn bunker-btn" title="Buy max CO2">
                üí® <span id="co2Display">-/-</span>
            </button>
            <button id="departAllBtn" class="action-btn" disabled title="Depart all vessels from harbor">
                üö¢
                <span id="vesselCount" class="action-badge" style="display: none;">0</span>
            </button>
            <button id="repairAllBtn" class="action-btn" disabled title="Repair all vessels with high wear">
                üîß
                <span id="repairCount" class="action-badge" style="display: none;">0</span>
            </button>
            <button id="allChatsBtn" class="action-btn" title="View all private messages">
                üì¨
                <span id="unreadBadge" class="action-badge" style="display: none; background: #ef4444;">0</span>
            </button>
            <button id="contactListBtn" class="action-btn" title="View contact list">
                üë•
            </button>
            <button id="settingsBtn" class="action-btn" title="Settings">
                ‚öôÔ∏è
            </button>
        </div>

        <div class="chat-feed" id="chatFeed">
            <div class="empty-message">Loading chat...</div>
        </div>

        <div class="input-section">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    placeholder="Type your message here... Use @ for mentions (Shift+Enter for new line)"
                    maxlength="1000"
                    autocomplete="off"
                ></textarea>
                <button id="sendMessageBtn">Send</button>
            </div>
            <div class="char-count" id="charCount">0 / 1000 characters</div>
            <div id="feedback"></div>
        </div>
    </div>
    
    <div id="allChatsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>All Private Conversations</h2>
                <button id="closeAllChatsBtn" class="close-btn">X</button>
            </div>
            <div class="messenger-feed" id="allChatsList">
            </div>
        </div>
    </div>

    <div id="contactListOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>üë• Contact List</h2>
                <button id="closeContactListBtn" class="close-btn">X</button>
            </div>
            <div class="messenger-feed" id="contactListFeed">
            </div>
        </div>
    </div>

    <div id="chatSelectionOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2 id="chatSelectionTitle">Select Conversation</h2>
                <button id="closeChatSelectionBtn" class="close-btn">X</button>
            </div>
            <div class="messenger-feed" id="chatSelectionList">
            </div>
        </div>
    </div>

    <div id="messengerOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <button id="backToSelectionBtn" class="close-btn" style="margin-right: 10px;">‚Üê</button>
                <h2 id="messengerTitle">Private Chat with ...</h2>
                <button id="closeMessengerBtn" class="close-btn">X</button>
            </div>
            <div class="messenger-feed" id="messengerFeed">
            </div>
            <div class="messenger-input" style="flex-direction: column; gap: 10px;">
                <div id="subjectInputWrapper" style="display: none;">
                    <input
                        type="text"
                        id="subjectInput"
                        placeholder="Subject..."
                        maxlength="100"
                        style="width: 100%; background: #2a2a2a; border: 1px solid #404040; color: #e0e0e0; padding: 10px 15px; border-radius: 6px; font-family: inherit;"
                    />
                </div>
                <div style="display: flex; gap: 10px;">
                    <textarea
                        id="messengerInput"
                        placeholder="Type message..."
                        maxlength="1000"
                        autocomplete="off"
                    ></textarea>
                    <button id="sendPrivateMessageBtn" class="send-btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsOverlay" class="overlay" style="display:none;">
        <div class="messenger-window">
            <div class="messenger-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button id="closeSettingsBtn" class="close-btn">X</button>
            </div>
            <div class="messenger-feed" style="padding: 20px; overflow-y: auto;">
                <div style="max-width: 500px; margin: 0 auto;">
                    <!-- Price Alerts Section -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0e0e0;">Price Alerts</h3>
                        <p style="margin: 0 0 15px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Get browser notifications when prices drop below these thresholds
                        </p>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label for="fuelThreshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                    ‚õΩ Fuel Alert Threshold ($/ton)
                                </label>
                                <input
                                    type="number"
                                    id="fuelThreshold"
                                    value="400"
                                    min="1"
                                    max="9999"
                                    style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                                />
                            </div>

                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                                <label for="co2Threshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                    üí® CO2 Alert Threshold ($/ton)
                                </label>
                                <input
                                    type="number"
                                    id="co2Threshold"
                                    value="7"
                                    min="1"
                                    max="9999"
                                    style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                                />
                            </div>
                        </div>

                        <button id="testAlertBtn" style="
                            margin-top: 12px;
                            width: 100%;
                            padding: 10px;
                            background: rgba(59, 130, 246, 0.2);
                            border: 1px solid rgba(59, 130, 246, 0.4);
                            border-radius: 6px;
                            color: #60a5fa;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.2)'">
                            üîî Test Browser Notification
                        </button>
                    </div>

                    <!-- Maintenance Section -->
                    <div>
                        <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0e0e0;">Maintenance</h3>
                        <p style="margin: 0 0 15px 0; color: #9ca3af; font-size: 13px; line-height: 1.4;">
                            Automatically repair vessels when wear reaches this threshold
                        </p>

                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(31, 41, 55, 0.5); border-radius: 8px;">
                            <label for="maintenanceThreshold" style="margin: 0; color: #e0e0e0; font-size: 14px;">
                                üîß Wear Threshold
                            </label>
                            <select
                                id="maintenanceThreshold"
                                style="width: 100px; padding: 6px 10px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;"
                            >
                                <option value="10">10%</option>
                                <option value="20">20%</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/script.js"></script>
</body>
</html>